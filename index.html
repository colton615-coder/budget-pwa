<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Budget Buddy</title>

  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0ea5e9" />

  <!-- Chart.js BEFORE app.js so canvases paint immediately -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="safe-edge"></div>
    <div class="container topbar">
      <div class="brand">
        <svg class="logo" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#0ea5e9"/></svg>
        <h1 class="app-title">Budget Buddy</h1>
      </div>
      <button class="icon-btn open-sheet" aria-label="Open menu">‚ò∞</button>
    </div>
  </header>

  <!-- Tabs (bottom) -->
  <nav id="tabs" class="tabs" role="tablist" aria-label="Sections">
    <button class="tab is-active" role="tab" aria-selected="true" aria-controls="panel-overview" data-tab="overview">üè†</button>
    <button class="tab" role="tab" aria-controls="panel-planner" data-tab="planner">üßÆ</button>
    <button class="tab" role="tab" aria-controls="panel-expenses" data-tab="expenses">üßæ</button>
    <button class="tab" role="tab" aria-controls="panel-goals" data-tab="goals">üéØ</button>
    <button class="tab" role="tab" aria-controls="panel-settings" data-tab="settings">‚öôÔ∏è</button>
  </nav>

  <!-- Bottom Sheet -->
  <nav id="sheet" class="sheet" aria-hidden="true" aria-label="Menu">
    <button id="sheet-close" class="icon-btn sheet-close" aria-label="Close">‚úï</button>
    <div class="sheet-content container">
      <button id="btn-export" class="menu-action">‚¨áÔ∏è Export (JSON)</button>
      <label class="menu-action file">‚¨ÜÔ∏è Import (JSON)
        <input id="file-import" type="file" accept="application/json" />
      </label>
      <button id="btn-clear-month" class="menu-action warn">üßπ Reset Current Month</button>
      <button id="btn-reset-all" class="menu-action warn">‚ùó Reset EVERYTHING</button>
    </div>
  </nav>

  <main class="container main">
    <!-- OVERVIEW -->
    <section id="panel-overview" class="panel is-active" role="tabpanel" aria-labelledby="tab-overview">
      <section class="tiles" aria-label="Monthly overview">
        <article class="tile tile--month">
          <p class="tile-label">Month</p>
          <input id="monthPicker" type="month" aria-label="Select month" />
        </article>
        <article class="tile"><p class="tile-label">Income</p><p class="tile-value" id="tl-income">$0</p></article>
        <article class="tile"><p class="tile-label">Expenses</p><p class="tile-value" id="tl-expenses">$0</p></article>
        <article class="tile"><p class="tile-label">Budget Result</p><p class="tile-value" id="tl-result">$0</p></article>
      </section>

      <section class="card">
        <h2>Analytics</h2>
        <div id="charts" class="charts">
          <div class="chart"><h3>Spending by Category</h3><canvas id="chart-category"></canvas></div>
          <div class="chart"><h3>Budget vs Actual</h3><canvas id="chart-budget"></canvas></div>
          <div class="chart"><h3>Needs vs Wants</h3><canvas id="chart-needwant"></canvas></div>
          <div class="chart"><h3>Cashflow</h3><canvas id="chart-cashflow"></canvas></div>
        </div>
      </section>
    </section>

    <!-- PLANNER -->
    <section id="panel-planner" class="panel" role="tabpanel" aria-labelledby="tab-planner">
      <section class="card">
        <h2>Budget Planner</h2>
        <div id="budget-groups" class="budget-grid"></div>
        <div class="totals">Budgeted Total: <strong id="budgeted-total">$0</strong></div>
      </section>
    </section>

    <!-- EXPENSES -->
    <section id="panel-expenses" class="panel" role="tabpanel" aria-labelledby="tab-expenses">
      <section class="card">
        <h2>Track Expenses</h2>
        <form id="tx-form" class="grid-form" autocomplete="off">
          <label class="field"><span class="field-label">Date</span><input type="date" id="tx-date" required /></label>
          <label class="field field--wide"><span class="field-label">Description</span><input id="tx-desc" required placeholder="Groceries @ Trader Joe's" /></label>
          <label class="field"><span class="field-label">Category</span><select id="tx-category" required></select></label>
          <label class="field"><span class="field-label">Need / Want</span>
            <select id="tx-needwant"><option value="need">Need</option><option value="want">Want</option></select>
          </label>
          <label class="field"><span class="field-label">Amount</span><input type="number" step="0.01" min="0" id="tx-amount" required /></label>
          <label class="field field--wide"><span class="field-label">Notes</span><input id="tx-notes" placeholder="Why over/under‚Ä¶" /></label>
          <button class="btn form-submit" type="submit">Add</button>
        </form>

        <div class="table-wrap">
          <table class="table" aria-label="Transactions">
            <thead>
              <tr><th>Date</th><th>Description</th><th>Category</th><th>Need/Want</th><th class="r">Amount</th><th>Notes</th><th class="c">Action</th></tr>
            </thead>
            <tbody id="tx-tbody"></tbody>
            <tfoot><tr><th colspan="4">Total Expenses</th><th class="r" id="tx-total">$0</th><th colspan="2"></th></tr></tfoot>
          </table>
        </div>
      </section>
    </section>

    <!-- GOALS -->
    <section id="panel-goals" class="panel" role="tabpanel" aria-labelledby="tab-goals">
      <section class="card">
        <h2>Savings Goals</h2>
        <form id="goal-form" class="row-form" autocomplete="off">
          <label class="field"><span class="field-label">Name</span><input id="goal-name" required /></label>
          <label class="field"><span class="field-label">Target</span><input type="number" step="0.01" min="0" id="goal-target" required /></label>
          <button class="btn">Add Goal</button>
        </form>
        <div id="goal-list" class="goals"></div>
      </section>

      <section class="card">
        <h2>Record Savings</h2>
        <form id="save-form" class="row-form" autocomplete="off">
          <label class="field"><span class="field-label">Goal</span><select id="save-goal" required></select></label>
          <label class="field"><span class="field-label">Date</span><input type="date" id="save-date" required /></label>
          <label class="field"><span class="field-label">Amount</span><input type="number" step="0.01" min="0" id="save-amount" required /></label>
          <button class="btn">Record</button>
        </form>
        <div class="table-wrap">
          <table class="table">
            <thead><tr><th>Date</th><th>Goal</th><th class="r">Amount</th><th class="c">Action</th></tr></thead>
            <tbody id="save-tbody"></tbody>
            <tfoot><tr><th colspan="2">This Month Saved</th><th class="r" id="save-total">$0</th><th></th></tr></tfoot>
          </table>
        </div>
      </section>
    </section>

    <!-- SETTINGS -->
    <section id="panel-settings" class="panel" role="tabpanel" aria-labelledby="tab-settings">
      <section class="card">
        <h2>Settings</h2>
        <form id="settings-form" class="grid-form" autocomplete="off">
          <label class="field"><span class="field-label">Currency</span><select id="set-currency"><option>USD</option><option>EUR</option><option>GBP</option><option>CAD</option><option>AUD</option><option>JPY</option><option>INR</option><option>MXN</option><option>BRL</option></select></label>
          <label class="field"><span class="field-label">Brand Color</span><input id="set-brand" type="color" value="#0ea5e9" /></label>
          <label class="field"><span class="field-label">Density</span><select id="set-density"><option value="comfortable">Comfortable</option><option value="compact">Compact</option></select></label>
          <label class="field"><span class="field-label">Default Need/Want</span><select id="set-default-nw"><option value="need">Need</option><option value="want">Want</option></select></label>
          <label class="field"><span class="field-label">Charts</span><select id="set-charts"><option value="on">On</option><option value="off">Off</option></select></label>
          <button class="btn form-submit" type="submit">Save Settings</button>
        </form>
      </section>

      <footer class="app-footer">
        <div id="status" role="status" aria-live="polite"></div>
        <div class="safe-edge"></div>
      </footer>
    </section>
  </main>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
